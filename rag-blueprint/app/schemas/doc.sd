# Copyright Vespa.ai. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.
schema doc {

    document doc {

        field id type string {
            indexing: summary | attribute
        }

        field text type string {
            
        }

        # Common fields for both FDA and SOP documents
        field analyte_biomarker type string {
            indexing: index | summary | attribute
            index: enable-bm25
        }

        field medical_specialty type string {
            indexing: index | summary | attribute
            index: enable-bm25
        }

        # FDA-specific fields
        field device_trade_name type string {
            indexing: index | summary | attribute
            index: enable-bm25
        }

        field product_code type string {
            indexing: summary | attribute
        }

        field intended_use type string {
            indexing: index | summary
            index: enable-bm25
        }

        field manufacturer_name type string {
            indexing: index | summary | attribute
            index: enable-bm25
        }

        field fda_decision_date type long {
            indexing: attribute | summary
        }

        # SOP-specific fields
        field procedure_name type string {
            indexing: index | summary | attribute
            index: enable-bm25
        }

        field specimen_type type string {
            indexing: index | summary | attribute
            index: enable-bm25
        }

        field purpose type string {
            indexing: index | summary
            index: enable-bm25
        }

        field equipment type array<string> {
            indexing: index | summary
            index: enable-bm25
        }

        field reagents type array<string> {
            indexing: index | summary
            index: enable-bm25
        }

        field quality_control type string {
            indexing: index | summary
            index: enable-bm25
        }

        field interpretation_guidelines type string {
            indexing: index | summary
            index: enable-bm25
        }

    }

    field chunks type array<string> {
        indexing: input text | chunk fixed-length 1024 | summary | index
        index: enable-bm25
    }

    field chunk_embeddings type tensor<int8>(chunk{}, x[96]) {
        indexing: input text | chunk fixed-length 1024 | embed | pack_bits | attribute | index
        attribute {
            distance-metric: hamming
        }
    }

    fieldset default {
        fields: chunks
    }

    document-summary top_3_chunks {
        from-disk
        summary chunks_top3 {
            source: chunks
            select-elements-by: top_3_chunk_sim_scores #this needs to be added a summary-feature to the rank-profile
        }
    }
}
